<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- DO NOT EDIT: file automatically generated by ucampas from
     /Users/graemejenkinson/cheri-website/cam/tesla/freebsd-b.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><meta content="text/css" http-equiv="Content-Style-Type" /><title>Building FreeBSD</title><link rel="stylesheet" type="text/css" media="all" href="https://www.cl.cam.ac.uk/style/layout.css" /><link rel="stylesheet" type="text/css" media="print" href="https://www.cl.cam.ac.uk/style/print.css" /><link href="https://www.cl.cam.ac.uk/style/blue.css" media="all" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="tesla.css" rel="stylesheet" type="text/css" /><link href="programming.html" rel="Next" /><link href="." rel="Up" /></head><body class="two-col dept">
<div id="skip"> <a href="#skip-content" accesskey="2">Skip to content</a>&#160;|&#160;<a href="https://www.cam.ac.uk/site/accesskeys.html" accesskey="0">Access key help</a> </div><div id="header">
  <div id="branding"><a href="https://www.cam.ac.uk/" accesskey="1"><img src="https://www.cl.cam.ac.uk/images/identifier.svg" alt="University of Cambridge" class="ucam" /></a>
  </div>

    <div id="site-search">

    <form action="http://web-search.cam.ac.uk/query.html" method="get">
      <fieldset>
      <label for="search-term">Search</label>
      <input name="qt" type="text" id="search-term" accesskey="4" value="" />
      <input id="search-button" src="https://www.cl.cam.ac.uk/images/button-search.gif" value="Search" alt="Search" title="Search" type="image" />
      </fieldset>
    </form>

    </div>
</div>

<div id="dept-title">
<h1><a href="../"></a></h1></div>

<div id="container"> <a name="skip-content" id="skip-content"></a>
<ul id="nav-breadcrumb"></ul><ul id="nav-primary"><li><div><a href="../">CTSRD&#160;&#187;</a></div></li><li><div><a href="../news.html">Project news</a></div></li><li><div><a href="../beri/">Bluespec Extensible RISC Implementation (BERI)&#160;&#187;</a></div></li><li><div><a href="../../capsicum/">Capsicum&#160;&#8594;</a></div></li><li><div><a href="../cheri/">Capability Hardware Enhanced RISC Instructions (CHERI)&#160;&#187;</a></div></li><li><div><a href="../soaap/">Security-Oriented Analysis of Application Programs (SOAAP)&#160;&#187;</a></div></li><li><div><a href=".">Temporally Enhanced Security Logic Assertions (TESLA)&#160;&#187;</a></div><ul><li><div><a href="build.html">Getting started</a></div></li><li><div><a href="workflow.html">Workflow</a></div></li><li class="active"><div><a href="freebsd.html">Building FreeBSD</a></div></li><li><div><a href="programming.html">Assertions and automata</a></div></li><li><div><a href="demos.html">Demos</a></div></li><li><div><a href="api">API Documentation&#160;&#8594;</a></div></li></ul></li><li><div><a href="../smten.html">Enhancing the Satisfiability Modulo Theories Experience (Smten)</a></div></li><li><div><a href="../publications.html">Publications</a></div></li><li><div><a href="../data/">Open Data&#160;&#187;</a></div></li><li><div><a href="../posters-slides.html">Posters and slides</a></div></li><li><div><a href="../people.html">Project members</a></div></li><li><div><a href="../related.html">Related</a></div></li></ul><div id="content"><div id="sub-brand"><p class="section">TESLA</p></div><div id="content-primary">
<h1 class="title">Building FreeBSD</h1><p>
Within the FreeBSD Perforce repository, there is a TESLA branch located at
<code>//depot/projects/ctsrd/tesla/src</code>.
</p>

<p>
To build the FreeBSD base system with TESLA instrumentation, first
<a href="environment.html">set up your environment</a>, then move some
LLVM-generated headers out of the way to prevent conflicts with FreeBSD system
ones:
</p>

<div class="console">cd <span class="green">$LLVM_BUILD_DIR</span>/lib/clang/3.3
mkdir unsafe
mv *.h unsafe/
mv unsafe/*intrin*.h unsafe/mm3dnow.h unsafe/mm_malloc.h .
</div>

<p>
You then need to set some environment variables.
With sh/bash/zsh, set:
</p>

<div class="console">export TESLA_SOURCE_DIR=/path/to/tesla
export TESLA_BUILD_DIR=<span class="green">$TESLA_SOURCE_DIR</span>/build     <span class="blue"># or wherever you ran cmake</span>
export PATH=<span class="green">$LLVM_BUILD_DIR</span>/bin:<span class="green">$PATH</span>:<span class="green">$TESLA_SOURCE_DIR</span>/scripts
</div>

<p>
Or in csh/tcsh:
</p>

<div class="console">setenv TESLA_SOURCE_DIR /path/to/tesla
setenv TESLA_BUILD_DIR <span class="green">$TESLA_SOURCE_DIR</span>/build     <span class="blue"># or wherever you ran cmake</span>
setenv PATH <span class="green">$LLVM_BUILD_DIR</span>/bin:<span class="green">$PATH</span>:<span class="green">$TESLA_SOURCE_DIR</span>/scripts
</div>

<p>
You then need to build the FreeBSD kernel toolchain, either by itself:
</p>

<div class="console"><span class="blue">$</span> make -jXX kernel-toolchain</div>

<p>
or as part of the <a href="http://www.freebsd.org/handbook/makeworld.html#canonical-build" target="_blank">normal buildworld process</a>:
</p>

<div class="console"><span class="blue">$</span> make -jXX buildworld</div>

<p>(where XX is the number of parallel jobs you'd like 'make' to run)</p>

<p>
Then run make in the FreeBSD source tree with the
<code>fbsdmake</code> wrapper script from the
<code><span class="keyword">$TESLA_SOURCE_DIR</span>/scripts</code>
directory:
</p>

<div class="console"><span class="blue">$</span> fbsdmake -jXX buildkernel</div>

<p>
This script works by setting environment variables
(<a href="https://wiki.freebsd.org/ExternalToolchain" target="_blank">XCC, XCXX, etc.</a>)
that describe the TESLA toolchain and calling <code>make</code>,
passing through command-line arguments like <code>-jXX</code>
and <code>buildkernel</code> above.
The result is an instrumented kernel in
<code><span class="keyword">$OBJDIR</span>/sys/TESLA</code>.
</p>
</div></div><ul id="site-info"><li class="copy">&#169; 2013-2016 Jonathan Anderson<br />Information provided by <a href="/~jra40/">Jonathan Anderson</a></li></ul></div>
</body></html>